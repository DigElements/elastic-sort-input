<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-menu/paper-menu.html">

<!--
A polymer web component that shows a dropdown of sorting options for the user and creates the string to pass onto elastic-sort based on the choice clicked.

Example:

    <elastic-sort-input
        field="date"
        selected="{{selected}}">
    </elastic-sort-input>

@demo demo/index.html
-->

<dom-module id="elastic-sort-input">
  <template>
    <style>
      :host {
        display: block;
        --paper-input-container-color: #727272;
        --paper-input-container-input-color: #212121;
        --paper-input-container-focus-color: #212121;
        --disabled-text-color: #727272;
      }

      label {
        font-weight: 500;
      }
    </style>
    <template is="dom-if" if="[[_menuOptions]]">
      <label>Sort Results By</label>
      <paper-dropdown-menu>
        <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{selected}}">
          <template is="dom-repeat" items="[[_menuOptions]]">
            <paper-item value="{{item.value}}">[[item.display]]</paper-item>
          </template>
        </paper-menu>
      </paper-dropdown-menu>
    </template>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'elastic-sort-input',

      properties: {
        /**
         * Sort field for menu options that do not have a field.
         * Default:  '_timestamp'
         */
        field: {
          type: String,
          value: '_timestamp'
        },

        /**
         * List of sort option objects with the following properties:
         *   display: The display name for the option in the menu.
         *   field:   The sort field for the option if different than the 'field' property (if undefined, set to the 'field' property).
         *   order:   The sort order for the option (if undefined, set to 'desc').
         */
        options: {
          type: Array,
          value: [{
            display: 'Best Match',
            field: '_score',
            order: 'desc'
          }, {
            display: 'Newest',
            order: 'desc'
          }, {
            display: 'Oldest',
            order: 'asc'
          }]
        },

        /**
         * Selected menu option elasticjs sort value.
         */
        selected: {
          type: String,
          value: '',
          notify: true
        },

        /**
         * List of options shown in the menu.
         */
        _menuOptions: {
          type: Array,
          computed: '_computeMenuOptions(field, options)'
        }
      },

      attached: function() {
        if(this._menuOptions && this._menuOptions.length > 0) {
          this.selected = this._menuOptions[0].value;
        }
      },

      _computeMenuOptions: function() {
        var self = this;
        var menuOptions;

        if(this.options) {
           menuOptions = this.options.map(function(option) {
            return {
              display: option.display,
              value: 'Sort("' + (option.field || self.field) + '").order("' + (option.order || 'desc') + '")'
            };
          });
        }
        return menuOptions;
      }
    });
  })();
  </script>
</dom-module>
